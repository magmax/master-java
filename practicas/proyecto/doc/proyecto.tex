\documentclass[a4paper,12pt]{article}

\usepackage{bookstyle}
\hyphenation{create}


\author{Miguel Ángel García Martínez}
\title{Master en J2EE}

\makeindex

\begin{document}

\maketitle
\newpage

\tableofcontents
\newpage

\section{El problema}

El cliente solicita desarrollar una aplicación que tendrá, por una
parte, una herramienta de escritorio que permita administrar una base
de datos. Esta base de datos contendrá clientes, secciones y
productos. Por otra parte, existirá una aplicación web que permita a
los clientes acceder al sistema para realizar sus compras.

Cada producto pertenecerá a una sección. De los clientes es necesario
almacenar, al menos, su teléfono, e-mail, nombre y una password para
acceder al sistema.

\section{Introducción}

La herramienta solicitada se dividirá en dos partes: la herramienta de
administración, distribuída como un \textit{JAR}, y la aplicación web,
distribuída como un \textit{WAR} y que necesitará un gestor de
aplicaciones tipo TomCat, GlassFish o similar.

Además, existirán dos componentes adicionales: uno de ellos con toda
la lógica de acceso a base de datos, de manera que pueda compartirse
entre las dos aplicaciones, y otro con componentes \textit{swing}
genéricos.

Este documento pretende mostrar la forma de instalar, configurar y
utilizar estas herramientas. En la parte final, se incluirá también un
apartado sobre la arquitectura de la misma.

\subsection{Compilación}

Aunque el proyecto se entrega compilado, existe la posibilidad de que
deseen compilarlo de nuevo. Para ello se ha utilizado la herramienta
``Maven''.  Esta herramienta de gestión permite la utilización de
\textit{plugins} para realizar distintas acciones, tales como
compilar, ensamblar, empaquetar, distribuir, realizar pruebas,
resolver dependencias\..., de manera que gestione todo el ciclo de
vida de una aplicación.

El archivo de configuración se denomina ``\textbf{pom.xml}'' y se
encuentra en el directorio raíz del proyecto. \textit{Maven} permite
saltarse la configuración mediante el uso de convenciones, como la
estructura de ficheros a utilizar, y por eso este archivo puede
resultar algo pequeño.  Tan solo se comentará aquí que todo lo
necesario para realizar la compilación se encuentra bajo el directorio
``src'', mientras que todo lo generado u obtenido se encontrará bajo
``target'', resultanto una estructura sencilla.

La orden de ejecución es la siguiente: \textbf{mvn install}

Tenga en cuenta que la primera vez que se ejecute puede tardar
bastante, ya que necesitará descargarse todas las herramientas
necesarias para la construcción de las aplicaciones. Requerirá acceso
a Internet.

Es muy importante el orden de compilación, ya que si no es posible que
no se encuentren algunos paquetes. Los primeros paquetes a compilar
deberían ser \textbf{proyect-common} y \textbf{easy-swing}. Tras ellos
podremos compilar los otros proyectos, \textbf{project-ui} y
\textbf{project-admin}. No será necesario que vuelva a preocuparse por
los dos primeros, ya que \textit{maven} gestionará su hubicación y
distribución. Los segundos se encontrarán en sus respectivas carpetas,
bajo los directorios ``target'', con los nombres:

\begin{itemize}
\item master-project-admin-1.0-SNAPSHOT-jar-with-dependencies.jar
\item project-ui-1.0-SNAPSHOT.war
\end{itemize}

Ambos son autocontenidos y no requieren de nada externo, salvo
componentes JavaScript que se encontrarán en la red.


\section{Instalación y configuración}

\subsection{Herramienta de administración}

Se recomienda comenzar por la herramienta de administración, ya que la
primera ejecución de la misma puede utilizarse para generar la base de
datos. La herramienta tiene unos valores por defecto que posiblemente
no se ajusten a sus requisitos. Por ello se recomienda crear un
archivo de configuración en la ruta en la que se encuentre el propio
\textit{JAR}. El archivo de configuración consistirá en un archivo
tipo \textit{properties} con la información de la base de datos.

Un ejemplo de archivo, con las propiedades que se pueden establecer,
sería:

\begin{lstlisting}[frame=single]
hibernate.dialect=org.hibernate.dialect.MySQLDialect
hibernate.connection.driver_class=com.mysql.jdbc.Driver
hibernate.connection.url=jdbc:mysql://localhost/db
hibernate.connection.username=myuser
hibernate.connection.password=mypassword
hibernate.show_sql=true
hibernate.hbm2ddl.auto=verify
\end{lstlisting}

En este listado se muestran todas las \textit{keyword}
disponibles. Éstas se explican a continuación:

\begin{itemize}
\item \textbf{hibernate.dialect}: Dialecto SQL a
  utilizar. Probablemente el de MySQL funcione con cualquier base de
  datos.
\item \textbf{hibernate.connection.driver}: Driver a utilizar.
\item \textbf{hibernate.connection.url}: String de conexión que
  permitirá conectarse con la base de datos. En el caso de MySQL,
  habrá que sustituir ``localhost'' por el nombre de la máquina que
  sirve el SGBD, y ``db'' por el nombre de la base de datos. Es
  importante saber que \textbf{la base de datos debe existir}.
\item \textbf{hibernate.connection.username}: Nombre del usuario que
  accederá a la base de datos.
\item \textbf{hibernate.connection.password}: Password para accceder a
  la base de datos.
\item \textbf{hibernate.show\_sql}: Soporta dos posibles valores:
  ``true'' y ``false''. En caso de valer ``true'', mostrará las
  sentencias SQL que se vayan ejecutando. Este modo podría limitarse
  en un caso real, pero se ha permitido por razones de depuración.
\item \textbf{hibernate.hbm2ddl.auto}: Con esta clave podemos indicar
  si queremos crear la base de datos, actualizarla, etc. Éste es un
  valor especial que se comenta más adelante.
\end{itemize}


\subsection{Interfaz Web}

Para instalar la interfaz web, basta con instalar el \textit{WAR}
desde la ventana de administración de TomCat.

Una vez desplegada la aplicación, será necesario editar algunos
valores del archivo \textit{web.xml} de la misma con el fin de
configurarla. Por homogeneidad, estos valores son los mismos que en la
herramienta de administración, aunque habrá que respetar el formato
del archivo. Ejemplo:

\begin{lstlisting}[frame=single, language=XML]
<context-param>
    <param-name>hibernate.show_sql</param-name>
    <param-value>true</param-value>
</context-param>
\end{lstlisting}

Lo normal será establecer los mismos valores que en de la herramienta
de administración, salvo para la clave
\textbf{hibernate.hbm2ddl.auto}, para la que es recomendable
establecer siempre el valor \textbf{verify}.



\subsection{Inicialización de la base de datos}

La creación de la base de datos se ha delegado en \textit{Hibernate}. Por ello es importante la \textit{keyword} \textbf{hibernate.hbm2ddl.auto}. Esta clave puede adquirir los siguientes valores:
\begin{itemize}
\item \textbf{create}: inicializará la base de datos. Si ésta ya estaba inicializada, la eliminará y volverá a crear.
\item \textbf{create-update}: supuestamente, inicializa la base de datos o la actualiza si ya existe. En la práctica, depende del controlador que haga su trabajo correctamente. Me ha dado muchos problemas y no recomiendo su uso.
\item \textbf{update}: tan sólo actualizará la base de datos, creando tablas nuevas. Es algo engañosa, ya que no modificará tablas existentes, aunque sus columnas se hayan modificado.
\item \textbf{verify}: comprueba que la base de datos es correcta.
\end{itemize}

Hay que recordar que, para que estas claves funcionen, la base de datos ya debe existir y el resto de los parámetros deben ser correctos.

\subsection{Pasos de configuración}

Una vez vista toda esta teoría, vayamos a la práctica en la aplicación:

\begin{enumerate}
\item Configurar la herramienta de administración, utilizando el valor ``create'' para la keyword ``hibernate.hbm2ddl.auto''.
\item Lanzar la herramienta de administración. Esto creará la base de datos.
\item Volver a configurar la herramienta de administración, utilizando el valor ``verify''.
\item Utilizar la herramienta de administración para configurar la herramienta.
\item Instalar y configurar la interfaz web.
\item Listo para usarse desde la parte web.
\end{enumerate}



\section{Manual de usuario}

\subsection{La herramienta de administración}

La herramienta de administración tiene una apariencia similar a la mostrada en la imagen


\end{document}
