\documentclass[a4paper,12pt]{article}

\usepackage{bookstyle}
\hyphenation{create}


\author{Miguel Ángel García Martínez}
\title{Master en J2EE}

\makeindex

\begin{document}

\maketitle
\newpage

\tableofcontents
\newpage

\section{El problema}

El cliente solicita desarrollar una aplicación que tendrá, por una
parte, una herramienta de escritorio que permita administrar una base
de datos. Esta base de datos contendrá clientes, secciones y
productos. Por otra parte, existirá una aplicación web que permita a
los clientes acceder al sistema para realizar sus compras.

Cada producto pertenecerá a una sección. De los clientes es necesario
almacenar, al menos, su teléfono, e-mail, nombre y una password para
acceder al sistema.

\section{Introducción}

La herramienta solicitada se dividirá en dos partes: la herramienta de
administración, distribuída como un \textit{JAR}, y la aplicación web,
distribuída como un \textit{WAR} y que necesitará un gestor de
aplicaciones tipo TomCat, GlassFish o similar.

Además, existirán dos componentes adicionales: uno de ellos con toda
la lógica de acceso a base de datos, de manera que pueda compartirse
entre las dos aplicaciones, y otro con componentes \textit{swing}
genéricos.

Este documento pretende mostrar la forma de instalar, configurar y
utilizar estas herramientas. En la parte final, se incluirá también un
apartado sobre la arquitectura de la misma.

\subsection{Compilación}

Aunque el proyecto se entrega compilado, existe la posibilidad de que
deseen compilarlo de nuevo. Para ello se ha utilizado la herramienta
``Maven''.  Esta herramienta de gestión permite la utilización de
\textit{plugins} para realizar distintas acciones, tales como
compilar, ensamblar, empaquetar, distribuir, realizar pruebas,
resolver dependencias\..., de manera que gestione todo el ciclo de
vida de una aplicación.

El archivo de configuración se denomina ``\textbf{pom.xml}'' y se
encuentra en el directorio raíz del proyecto. \textit{Maven} permite
saltarse la configuración mediante el uso de convenciones, como la
estructura de ficheros a utilizar, y por eso este archivo puede
resultar algo pequeño.  Tan solo se comentará aquí que todo lo
necesario para realizar la compilación se encuentra bajo el directorio
``src'', mientras que todo lo generado u obtenido se encontrará bajo
``target'', resultanto una estructura sencilla.

La orden de ejecución es la siguiente: \textbf{mvn install}

Tenga en cuenta que la primera vez que se ejecute puede tardar
bastante, ya que necesitará descargarse todas las herramientas
necesarias para la construcción de las aplicaciones. Requerirá acceso
a Internet.

Es muy importante el orden de compilación, ya que si no es posible que
no se encuentren algunos paquetes. Los primeros paquetes a compilar
deberían ser \textbf{proyect-common} y \textbf{easy-swing}. Tras ellos
podremos compilar los otros proyectos, \textbf{project-ui} y
\textbf{project-admin}. No será necesario que vuelva a preocuparse por
los dos primeros, ya que \textit{maven} gestionará su hubicación y
distribución. Los segundos se encontrarán en sus respectivas carpetas,
bajo los directorios ``target'', con los nombres:

\begin{itemize}
\item master-project-admin-1.0-SNAPSHOT-jar-with-dependencies.jar
\item project-ui-1.0-SNAPSHOT.war
\end{itemize}

Ambos son autocontenidos y no requieren de nada externo, salvo
componentes JavaScript que se encontrarán en la red.


\section{Instalación y configuración}

\subsection{Herramienta de administración}

Se recomienda comenzar por la herramienta de administración, ya que la
primera ejecución de la misma puede utilizarse para generar la base de
datos. La herramienta tiene unos valores por defecto que posiblemente
no se ajusten a sus requisitos. Por ello se recomienda crear un
archivo de configuración en la ruta en la que se encuentre el propio
\textit{JAR}. El archivo de configuración consistirá en un archivo
tipo \textit{properties} con la información de la base de datos.

Un ejemplo de archivo, con las propiedades que se pueden establecer,
sería:

\begin{lstlisting}[frame=single]
hibernate.dialect=org.hibernate.dialect.MySQLDialect
hibernate.connection.driver_class=com.mysql.jdbc.Driver
hibernate.connection.url=jdbc:mysql://localhost/db
hibernate.connection.username=myuser
hibernate.connection.password=mypassword
hibernate.show_sql=true
hibernate.hbm2ddl.auto=verify
\end{lstlisting}

En este listado se muestran todas las \textit{keyword}
disponibles. Éstas se explican a continuación:

\begin{itemize}
\item \textbf{hibernate.dialect}: Dialecto SQL a
  utilizar. Probablemente el de MySQL funcione con cualquier base de
  datos.
\item \textbf{hibernate.connection.driver}: Driver a utilizar.
\item \textbf{hibernate.connection.url}: String de conexión que
  permitirá conectarse con la base de datos. En el caso de MySQL,
  habrá que sustituir ``localhost'' por el nombre de la máquina que
  sirve el SGBD, y ``db'' por el nombre de la base de datos. Es
  importante saber que \textbf{la base de datos debe existir}.
\item \textbf{hibernate.connection.username}: Nombre del usuario que
  accederá a la base de datos.
\item \textbf{hibernate.connection.password}: Password para accceder a
  la base de datos.
\item \textbf{hibernate.show\_sql}: Soporta dos posibles valores:
  ``true'' y ``false''. En caso de valer ``true'', mostrará las
  sentencias SQL que se vayan ejecutando. Este modo podría limitarse
  en un caso real, pero se ha permitido por razones de depuración.
\item \textbf{hibernate.hbm2ddl.auto}: Con esta clave podemos indicar
  si queremos crear la base de datos, actualizarla, etc. Éste es un
  valor especial que se comenta más adelante.
\end{itemize}


\subsection{Interfaz Web}

Para instalar la interfaz web, basta con instalar el \textit{WAR}
desde la ventana de administración de TomCat.

Una vez desplegada la aplicación, será necesario editar algunos
valores del archivo \textit{web.xml} de la misma con el fin de
configurarla. Por homogeneidad, estos valores son los mismos que en la
herramienta de administración, aunque habrá que respetar el formato
del archivo. Ejemplo:

\begin{lstlisting}[frame=single, language=XML]
<context-param>
    <param-name>hibernate.show_sql</param-name>
    <param-value>true</param-value>
</context-param>
\end{lstlisting}

Lo normal será establecer los mismos valores que en de la herramienta
de administración, salvo para la clave
\textbf{hibernate.hbm2ddl.auto}, para la que es recomendable
establecer siempre el valor \textbf{verify}.



\subsection{Inicialización de la base de datos}

La creación de la base de datos se ha delegado en \textit{Hibernate}. Por ello es importante la \textit{keyword} \textbf{hibernate.hbm2ddl.auto}. Esta clave puede adquirir los siguientes valores:
\begin{itemize}
\item \textbf{create}: inicializará la base de datos. Si ésta ya estaba inicializada, la eliminará y volverá a crear.
\item \textbf{create-update}: supuestamente, inicializa la base de datos o la actualiza si ya existe. En la práctica, depende del controlador que haga su trabajo correctamente. Me ha dado muchos problemas y no recomiendo su uso.
\item \textbf{update}: tan sólo actualizará la base de datos, creando tablas nuevas. Es algo engañosa, ya que no modificará tablas existentes, aunque sus columnas se hayan modificado.
\item \textbf{verify}: comprueba que la base de datos es correcta.
\end{itemize}

Hay que recordar que, para que estas claves funcionen, la base de datos ya debe existir y el resto de los parámetros deben ser correctos.

\subsection{Pasos de configuración}

Una vez vista toda esta teoría, vayamos a la práctica en la aplicación:

\begin{enumerate}
\item Configurar la herramienta de administración, utilizando el valor ``create'' para la keyword ``hibernate.hbm2ddl.auto''.
\item Lanzar la herramienta de administración. Esto creará la base de datos.
\item Volver a configurar la herramienta de administración, utilizando el valor ``verify''.
\item Utilizar la herramienta de administración para configurar la herramienta.
\item Instalar y configurar la interfaz web.
\item Listo para usarse desde la parte web.
\end{enumerate}



\section{Manual de usuario}

\subsection{La herramienta de administración}

La herramienta de administración tiene una apariencia similar a la
mostrada en la figura~\ref{fig:adminusers}. Desde esta vista se pueden
gestionar los usuarios, aunque se ha deshabilitado el botón de añadir,
ya que no es lógico que el administrador pueda cambiar la contraseña.

\begin{figure}
  \centering
  \includegraphics[width=13cm]{images/admin-users.png}
  \caption{Vista de usuarios}
  \label{fig:adminusers}
\end{figure}

Desde esta pantalla podemos pulsar sobre el botón de edición, que nos
abrirá una pantalla como la de la
figura~\ref{fig:adminusersedit}. Como se observa en la imagen, los
botones se encuentran habilitados para permitir la edición.

\begin{figure}
  \centering
  \includegraphics[width=13cm]{images/admin-users-edit.png}
  \caption{Edición de usuarios}
  \label{fig:adminusersedit}
\end{figure}

Si hubiéramos pulsado sobre el botón de detalle, se abriría la misma
ventana pero con los botones deshabilitados, tal y como se muestra en
la figura~\ref{fig:adminusersdetail}.

\begin{figure}
  \centering
  \includegraphics[width=13cm]{images/admin-users-detail.png}
  \caption{Detalle de usuario}
  \label{fig:adminusersdetail}
\end{figure}

La herramienta permite añadir varios teléfonos y varias direcciones de
e-mail por cada usuario, ya que se entiende que esta puede ser una
práctica habitual. Sin embargo, desde la herramienta web sólo se podrá
acceder a una de ellas.

En las pestañas de la zona izquierda puede seleccionarse el apartado
de \textit{Secciones} o el de \textit{Productos}, abriendo pantallas
similares a las mostradas en las figuras~\ref{fig:adminsections}
y~\ref{fig:adminproducts}, respectivamente.

\begin{figure}
  \centering
  \includegraphics[width=13cm]{images/admin-sections.png}
  \caption{Vista de secciones}
  \label{fig:adminsections}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=13cm]{images/admin-products.png}
  \caption{Vista de productos}
  \label{fig:adminproducts}
\end{figure}

El funcionamiento de estas ventanas es similar a la de usuarios, ya
que se ha tratado de buscar cierta homogeneidad en el uso.



\subsection{La interfaz Web}

La interfaz web comenzará mostrándonos la ventana de inicio de sesión,
correspondiente con la figura~\ref{fig:weblogin}.

\begin{figure}
  \centering
  \includegraphics[width=13cm]{images/web-login.png}
  \caption{Ventana de entrada}
  \label{fig:weblogin}
\end{figure}

Desde esta ventana se pueden realizar tres operaciones. Por una parte,
se puede seleccionar el enlace a ``About...'', que será común en todas
las ventanas, llevándonos a una ventana de ayuda.

Por otra parte, podemos pulsar sobre el botón ``Entrar'', que
intentará autenticarnos. Si alguno de los campos estuviera vacío, se
mostrará un icono de advertencia cuya leyenda indicará que el campo
está vacío. Veremos un ejemplo más adelante.

Por último, está la opción de pulsar sobre el botón ``Registro'', que
nos llevará a la ventana de registro, que es similar a la
figura~\ref{fig:webregistry}.

\begin{figure}
  \centering
  \includegraphics[width=13cm]{images/web-registry.png}
  \caption{Ventana de registro}
  \label{fig:webregistry}
\end{figure}

\begin{figure}
  \centering
  \includegraphics[width=13cm]{images/web-registry-login-fail.png}
  \caption{Ventana de registro tras autenticación fallida}
  \label{fig:webloginfail}
\end{figure}

Si en la ventana de login (Figura~\ref{fig:weblogin}) introducimos
erróneamente nuestras credenciales, nos llevará a la ventana de
registro, pero mostrando un mensaje especial tal y como se muestra en
la figura~\ref{fig:webloginfail}. 

Ya sea en la figura~\ref{fig:webregistry} o en la~\ref{fig:webloginfail},
podemos ver el botón ``Volver'', que nos permitirá regresar a la
ventana inicial. También podemos ver el enlace ``About...'', del que
ya hemos hablado antes. Finalmente, tenemos el botón ``Registrarse''
que permite el registro, siempre y cuando los valores introducidos
sean válidos.

Si la validación de los mismos no es correcta, se mostrará un icono de
advertencia a su lado cuya leyenda ofrecerá más detalle de la razón
por la que no es válida (figura~\ref{fig:webregistryfail}).
\begin{figure}
  \centering
  \includegraphics[width=13cm]{images/web-registry-fail.png}
  \caption{Ventana de registro con entradas erróneas}
  \label{fig:webregistryfail}
\end{figure}

Una vez registrados y autenticados correctamente, accederemos a la
ventana de ventas (figura~\ref{fig:webshop}). Desde esta ventana
podremos realizar las compras seleccionando una sección y pulsando el
icono de la izquierda que representa un carro de la compra. Cada vez
que se seleccione una sección diferente, una transición suave nos
permitirá ver las productos disponibles en esa sección.

\begin{figure}
  \centering
  \includegraphics[width=13cm]{images/web-shop.png}
  \caption{Ventana de ventas}
  \label{fig:webshop}
\end{figure}

Una vez hayamos realizado nuestra compra, tendremos una ventana
similar a la figura~\ref{fig:webshopbuying}, podremos ``Formalizar
compra''. Si nos hemos equivocado, podemos pulsar el icono de una
papelera situado a la izquierda de los productos.

\begin{figure}
  \centering
  \includegraphics[width=13cm]{images/web-shop-buying.png}
  \caption{Ventana de ventas con lista de la compra}
  \label{fig:webshopbuying}
\end{figure}

Cuando formalicemos la compra, iremos a una ventana que nos indicará
que la compra se ha realizado con éxito.

Existe un botón más, llamado ``Facturación'', que sólo se mostrará en
caso de ser administrador. Este botón permite llegar a la ventana de
administración, en la que, tras seleccionar unas fechas (como se
indica en la figura~\ref{fig:webinvoice}), podemos mostar las facturas
que tuvieron lugar en el periodo de tiempo indicado (figura~\ref{fig:webinvoices}

\begin{figure}
  \centering
  \includegraphics[width=13cm]{images/web-invoice.png}
  \caption{Ventana de facturación}
  \label{fig:webinvoice}
\end{figure}


\end{document}
